<!DOCTYPE html SYSTEM "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>MathML from Word in DITA For Publishers</title>
  </head>
  <body>
    <p>W. Eliot Kimber, Principal Consultant, Contrext, LLC (www.contrext.com)</p>
    <h1>MathML from Word in DITA For Publishers</h1>
    <p>The DITA for Publishers (D4P) project (<a href="http://dita4publishers.sourceforge.net">dita4publishers.sourceforge.net</a>) provides a general Microsoft Word to DITA transformation framework.
      This framework makes it relatively easy to generate DITA documents from styled Word documents.</p>
    <p>Upcoming D4P release 0.9.19 includes support for getting MathML from Word documents where the MathML equations are stored as text content as generated by the MathType plugin from MathType
      equations.</p>
    <p>This makes it easy for you to use MathType in Word and produce DITA documents that include the equations as MathML markup, rather than as images. You can then use the MathML support in XML
      editors, such as OxygenXML's integration with MathType, so edit the equations in the DITA source.</p>
    <p>The DITA for Publishers project includes a domain for including inline MathML in DITA content. In addition, DITA 1.3 will include a standard domain for including MathML, either inline or by
      reference to separate XML documents.</p>
    <h2>Generating DITA with MathML From Word Documents</h2>
    <p>To get your MathML into your DITA from Word, you need to set up the Word-to-DITA style to tag mapping with the details of the tagging to use for the MathML. You must specify the name of the
      element to contain the &lt;m:math> element and, optionally, a parent container that represents the equation the MathML produces. </p>
    <p>When you convert MathType equations into MathML in the Word document, the MathML goes into text with the character style name "MTConvertedEquation". The D4P Word-to-DITA transform treats each
      converted equation as a single paragraph with the paragraph style "MTConvertedEquation", where the paragraph contains a single &lt;mathml> element.</p>
    <p>You can then use this style name in your style-to-tag map to put the appropriate wrappers around the MathML markup.</p>
    <p>For example, to use the D4P markup, you would create a style map entry like this:</p>
    <pre>    &lt;style
      styleName="MTConvertedEquation"
      containerType="d4p_display-equation"
      tagName="d4p_MathML"
      level="1"
      structureType="block"
      topicZone="body"
    /></pre>
    <p>Which will result in markup like this:</p>
    <pre>&lt;d4p_display-equation>
  &lt;d4p_MathML>
    &lt;m:math xmlns:m="http://www.w3.org/1998/Math/MathML" display="block">
      &lt;m:semantics>
        &lt;m:mrow>
          &lt;m:mfrac>
            &lt;m:mrow>
              &lt;m:mi>d&lt;/m:mi>
              &lt;m:mi>x&lt;/m:mi>
            &lt;/m:mrow>
            &lt;m:mrow>
              &lt;m:mi>d&lt;/m:mi>
              &lt;m:mi>t&lt;/m:mi>
            &lt;/m:mrow>
          &lt;/m:mfrac>
          &lt;m:mo>=&lt;/m:mo>
          &lt;m:mi>J&lt;/m:mi>
          &lt;m:mo>.&lt;/m:mo>
          &lt;m:mi>X&lt;/m:mi>
          &lt;m:mo stretchy="false">(&lt;/m:mo>
          &lt;m:mi>t&lt;/m:mi>
          &lt;m:mo stretchy="false">)&lt;/m:mo>
        &lt;/m:mrow>
      &lt;/m:semantics>
    &lt;/m:math>
  &lt;/d4p_MathML>
&lt;/d4p_display-equation></pre>
    <p>To generate the DITA 1.3 markup you would use this style mapping:</p>
    <pre>&lt;style
      styleName="MTConvertedEquation"
      containerType="equation-block"
      tagName="mathml"
      level="1"
      structureType="block"
      topicZone="body"
/></pre>
    <p>Which would produce this markup:</p>
    <pre> &lt;equation-block>
  &lt;mathml>
      &lt;m:math display='block'>
        &lt;m:semantics>
          &lt;m:mrow>
            &lt;m:mfrac>
              &lt;m:mrow>
                &lt;m:mo>&amp;#x2212;&lt;/m:mo>&lt;m:mi>b&lt;/m:mi>&lt;m:mo>&amp;#x00B1;&lt;/m:mo>&lt;m:msqrt>
                  &lt;m:mrow>
                    &lt;m:msup>
                      &lt;m:mi>b&lt;/m:mi>
                      &lt;m:mn>2&lt;/m:mn>
                    &lt;/m:msup>
                    &lt;m:mo>&amp;#x2212;&lt;/m:mo>&lt;m:mn>4&lt;/m:mn>&lt;m:mi>a&lt;/m:mi>&lt;m:mi>c&lt;/m:mi>
                  &lt;/m:mrow>
                &lt;/m:msqrt>                
              &lt;/m:mrow>
              &lt;m:mrow>
                &lt;m:mn>2&lt;/m:mn>&lt;m:mi>a&lt;/m:mi>
              &lt;/m:mrow>
            &lt;/m:mfrac>            
          &lt;/m:mrow>
        &lt;/m:semantics>
      &lt;/m:math>
    &lt;/mathml>
&lt;/equation-block></pre>
    <p>The support for MathML in the D4P Word-to-DITA transform is generic in that the MathML markup could come from any source. The transform is implemented as a two-phase process. The first phase
      generates an intermediate file (the "simple wordprocessing markup") file and the second phase converts the intermediate file into DITA using the style-to-tag mapping.</p>
    <p>In the intermediate file the MathML is just normal MathML markup. This means that the MathML could come from other sources, such as from Word's built-in math markup language or from the
      MathType equations in other ways, once they are available. The D4P Word-to-DITA transform is completely extensible so if you needed to you could customize the MathML generation process in
      whatever way you required.</p>
    <h2>Rendering MathML Using the DITA Open Toolkit</h2>
    <p>Using the DITA Open Toolkit, you can render MathML to HTML and to PDF.</p>
    <p>To render MathML to HTML, you can use the D4P math domain plugin to add MathML support to the base Open Toolkit HTML processing. The generated HTML can include references to the open-source
      MathJax Javascript library, which renders MathML in any Javascript-aware browser. The D4P math domain HTML plugin also supports both the D4P-provided MathML integration and equation elements as
      well as the DITA 1.3 MathML integration and equation elements (The D4P-specific MathML and equation domains will be made obsolete by DITA 1.3 and the MathML support currently in DITA for
      Publishers will be built in to a future version of the Open Toolkit).</p>
    <p>To render MathML to PDF using the Open Toolkit you are dependent on the XSL-FO engine you use. Both Apache FOP and Antenna House XSL Formatter support direct rendering of MathML included in the
      FO file. FOP requires the separate JEuclid libraries (from the Apache JEuclid project). Antenna House's support is built in.</p>
    <p>The RenderX XEP  product does not provide direct rendering of MathML, so you would need to generate images or SVG from the equations and then reference those from the FO. This wouldn't be that
      hard to implement (e.g., using either the Design Science MathFlow SDK or the JEuclid library).</p>
  </body>
</html>