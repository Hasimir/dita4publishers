<process-definition xmlns="urn:jbpm.org:jpdl-3.1" name="Docx To XML">
  <start-state name="StartNode">
    <transition name="" to="Set Parent CA Node to Variable" />
  </start-state>
  <end-state name="EndNode" />
  <node name="DOCX to DITA XML">
    <action class="org.dita4publishers.rsuite.workflow.actions.Docx2XmlActionHandler">
      <styleMapUri>rsuite:/res/plugin/dita4publishers/xslt/word2xml/sample_tagmap.xml</styleMapUri>
      <xsltUri>rsuite:/res/plugin/dita4publishers/xslt/word2xml/docx2article.xsl</xsltUri>
      <outputPath>${exportDir}</outputPath>
      <resultFileName>${moBaseName}.xml</resultFileName>
    </action>
    <transition name="" to="Exception Occur?" />
  </node>
  <task-node name="XML Generation Failed">
    <task name="XML Generation Failed" description="#{moDisplayName}: Generation of XML from DOCX failed: #{exceptionMessage}          
    &lt;br/&gt;See conversion report &lt;a href='/rsuite/rest/v1/report/generated/#{xformReportId}?skey=RSUITE-SESSION-KEY' target='_xformReport'&gt;#{xformReportFileName}&lt;a/&gt;">
      <event type="task-create">
        <action class="com.reallysi.rsuite.system.workflow.actions.taskcreate.AssignTaskToUserFromVariable" />
      </event>
      <assignment pooled-actors="RSuiteAdministrator" />
      <controller class="com.reallysi.rsuite.system.workflow.RSuiteJbpmTaskControllerDelegation">
        <variable name="rsuite contents" access="read,,required" />
      </controller>
    </task>
    <transition name="End workflow" to="EndNode" />
    <transition name="Retry the Generation" to="Clear Exception Status" />
  </task-node>
  <decision name="Exception Occur?" expression="#{EXCEPTION_OCCUR=='true'}">
    <transition name="true" to="XML Generation Failed" />
    <transition name="false" to="Load the XML" />
  </decision>
  <task-node name="XML Generated">
    <task name="Xml Generated" description="#{moDisplayName}: XML generated and updated in RSuite.     &lt;br/&gt;File also exported to #{sharedExportDir}          
    &lt;br/&gt;See conversion report &lt;a href='/rsuite/rest/v1/report/generated/#{xformReportId}?skey=RSUITE-SESSION-KEY'       target='_xformReport'&gt;#{xformReportFileName}&lt;a/&gt;">
      <event type="task-create">
        <action class="com.reallysi.rsuite.system.workflow.actions.taskcreate.AssignTaskToUserFromVariable" />
      </event>
      <assignment pooled-actors="RSuiteAdministrator" />
      <controller class="com.reallysi.rsuite.system.workflow.RSuiteJbpmTaskControllerDelegation">
        <variable name="rsuite contents" access="read,,required" />
      </controller>
    </task>
    <transition name="Done" to="EndNode" />
  </task-node>
  <node name="Set MO Details to Variables">
    <action class="com.reallysi.rsuite.system.workflow.actions.SetVariablesFromMoDetails" />
    <transition name="" to="DOCX to DITA XML" />
  </node>
  <node name="Set Variables from Properties">
    <action class="com.reallysi.rsuite.system.workflow.actions.SetGlobalVariablesActionHandler">
      <variableNames>exportDir;sharedExportDir</variableNames>
      <values>/export/xml;//hostmachine/export/xml</values>
    </action>
    <transition name="" to="Set MO Details to Variables" />
  </node>
  <node name="Clear Exception Status">
    <action class="com.reallysi.rsuite.system.workflow.actions.ClearExceptionStatus" />
    <transition name="" to="DOCX to DITA XML" />
  </node>
  <node name="Load the XML">
    <action class="com.reallysi.rsuite.system.workflow.actions.LoadXmlByAliasActionHandler">
      <alias>${moBaseName}.xml</alias>
      <commitMessage>Regenerated by ${rsuiteUserId}</commitMessage>
      <fileToLoad>${exportDir}/${moBaseName}/${moBaseName}.xml</fileToLoad>
      <parentMoId>${parentMoId}</parentMoId>
    </action>
    <transition name="" to="Load Failed?" />
  </node>
  <decision name="Load Failed?" expression="#{EXCEPTION_OCCUR=='true'}">
    <transition name="false" to="XML Generated" />
    <transition name="true" to="Load of XML Failed" />
  </decision>
  <task-node name="Load of XML Failed">
    <task name="Load of XML Failed" description="#{moDisplayName}: Load of generated XML failed: #{exceptionMessage}     &lt;br/&gt;File also exported to #{sharedExportDir}         
    &lt;br/&gt;See conversion report &lt;a href='/rsuite/rest/v1/report/generated/#{xformReportId}?skey=RSUITE-SESSION-KEY'       target='_xformReport'&gt;#{xformReportFileName}&lt;a/&gt;">
      <event type="task-create">
        <action class="com.reallysi.rsuite.system.workflow.actions.taskcreate.AssignTaskToUserFromVariable" />
      </event>
      <assignment />
      <controller class="com.reallysi.rsuite.system.workflow.RSuiteJbpmTaskControllerDelegation">
        <variable name="rsuite contents" access="read,,required" />
      </controller>
    </task>
    <transition name="End workflow" to="EndNode" />
    <transition name="Retry the load" to="Clear Load Exception Status" />
  </task-node>
  <node name="Clear Load Exception Status">
    <action class="com.reallysi.rsuite.system.workflow.actions.ClearExceptionStatus" />
    <transition name="" to="Load the XML" />
  </node>
  <node name="Set Parent CA Node to Variable">
    <action class="com.reallysi.rsuite.system.workflow.actions.SetParentBrowseTreeNodeToVariable" />
    <transition name="" to="Set Variables from Properties" />
  </node>
</process-definition>